<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <style>
        @page { size: A4; margin: 0; }
        .header {
            background-image: url('{{ header_image.url }}');
            background-size: 100% 40mm;
            background-repeat: no-repeat;
            height: 40mm;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
        }
        body {
            font-family: 'Koodak', sans-serif;
            font-size: 10pt;
            padding: 40mm 6mm 0 10mm; /* فاصله محتوا از هدر */
            direction: rtl;
            text-align: right;
            position: relative;
            min-height: 297mm;
            padding-bottom: 40mm;
        }
        @font-face { font-family: 'Koodak'; src: url('{{ font_path }}') format('truetype'); }

        .top-right-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            padding-right: 20mm;
            padding-top: 8mm;
        }
        .top-right-section .right p:first-child {
            font-weight: bold;  /* بولد */
            font-size: 16pt;    /* سایز 14 */
            margin: 0;          /* حذف مارجین اضافی */
        }
        .top-right-section .right p:last-child {
            font-weight: normal; /* معمولی */
            font-size: 8pt;     /* سایز 11 */
            margin: 0;
        }

        /* استایل جدید برای لوگو مستقل */
        .logo {
            position: absolute;
            top: 15mm;
            left: 50%;
            transform: translateX(-50%);
            max-width: 45mm;
            z-index: 20;
        }

        .info-section {
            display: flex;
            justify-content: space-between;
            margin: -5mm 0 3mm 0;
            font-size: 9pt;
            align-items: baseline;
            z-index: 20;
        }
        .info-section div { width: 33%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .info-section div:nth-child(1) { text-align: right; }
        .info-section div:nth-child(2) { text-align: center; }
        .info-section div:nth-child(3) { text-align: left; }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 7mm;
        }
        .table th, .table td {
            border: 1px solid #ddd;
            padding: 2mm 1mm 2mm 1mm;
            text-align: center;
            line-height: 1.3;
            align-content: center;
            align-items: center;
            font-size: 9pt;
            white-space: normal;   /* اجازه wrap متن */
            word-break: break-word; /* متن طولانی بشکند */
        }
        .table th { background-color: #f2f2f2; }

        /* تعیین عرض ستون‌ها */
        .table th:nth-child(1), .table td:nth-child(1) { width: 5%; }
        .table th:nth-child(2), .table td:nth-child(2) { width: 25%; }
        .table th:nth-child(3), .table td:nth-child(3) { width: 8%; }
        .table th:nth-child(4), .table td:nth-child(4) { width: 10%; }
        .table th:nth-child(5), .table td:nth-child(5) { width: 15%; }
        .table th:nth-child(6), .table td:nth-child(6) { width: 15%; }
        .table th:nth-child(7), .table td:nth-child(7) { width: 22%; }

        .summary {
            text-align: right;
            margin-bottom: 1mm;
            font-size: 9pt;
        }
        .summary p { margin: 0 0 3mm 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .highlight {
            background-color: #ccc;
            padding: 2mm 0 2mm 0;
            display: flex;
            justify-content: space-around;
            margin-bottom: 10mm;
            font-weight: bold;
            font-size: 10pt;
            z-index: 20;
        }
        .highlight span { max-width: 45%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .notes {
            font-size: 9pt;
            line-height: 1.3;
            overflow: hidden;
            word-break: break-word;
            white-space: pre-wrap;
            z-index: 20;
            margin-bottom: 3mm;
        }
        .repair-address{
            font-size: 9pt;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: pre-wrap;
            z-index: 20;
            margin-bottom: 3mm;
        }
        .phone-numbers {
            font-size: 9pt;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: pre-wrap;
            z-index: 20;
        }
        .stamp {
            position: absolute;
            bottom: 65mm;
            right: 80mm;
            max-width: 30mm;
            opacity: 0.7; /* 50 درصد */
            z-index: 20;  /* بالای محتوا */
            transform: rotate(-10deg);
        }
        .footer {
            background-image: url('{{ footer_image.url }}');
            background-size: 100% 40mm;
            background-repeat: no-repeat;
            height: 40mm;
            position: absolute;
            bottom: 25mm;
            left: 0;
            right: 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="top-right-section">
            <div class="right">
                <p>{{ right_text1 }}</p>
                <p>{{ right_text2 }}</p>
            </div>
            <div class="left"></div>
        </div>
    </div>

    <!-- لوگو مستقل و وسط‌چین -->
    <img src="{{ logo_image.url }}" class="logo" alt="Logo">

    <div class="info-section">
        <div>
            <p>نام مشتری: {{ customer_name }}</p>
            <p>آدرس: {{ address }}</p>
        </div>
        <div>تلفن / موبایل: {{ phone }}</div>
        <div>
            <p>شماره فاکتور: {{ invoice_number }}</p>
            <p>تاریخ صدور: {{ date }}</p>
        </div>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>ردیف</th>
                <th>نام کالا/خدمات</th>
                <th>واحد</th>
                <th>تعداد/مقدار</th>
                <th>بهای واحد (ریال)</th>
                <th>مبلغ کل (ریال)</th>
                <th>شرح کالا/خدمات</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.row }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.unit }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.price }}</td>
                <td>{{ item.total }}</td>
                <td>{{ item.description }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="summary">
        <p>جمع کل فاکتور: {{ subtotal_str }} ریال</p>
        <p>تخفیف: {{ discount_str }} ریال</p>
    </div>

    <div class="highlight">
        <span>مبلغ قابل پرداخت: {{ total_str }} ریال</span>
        <span>مبلغ قابل پرداخت به حروف: {{ total_words }}</span>
    </div>

    <div class="notes">{{ notes }}</div>
    <div class="repair-address">{{ repair_address }}</div>
    <div class="phone-numbers">{{ phone_numbers }}</div>

    <img src="{{ stamp_image.url }}" class="stamp" alt="Stamp">

    <div class="footer"></div>
</body>
</html>
